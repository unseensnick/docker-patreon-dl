services:
  # GUI Application with VNC server
  patreon-dl-gui:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: patreon-dl-gui
    hostname: patreon-dl-gui
    
    # Expose VNC port for direct VNC client access
    ports:
      - "5900:5900"  # VNC port
    
    # Persistent storage
    volumes:
      # Downloaded content
      - ./downloads:/downloads
      # Application data (configs, cookies, etc.)
      - ./app-data:/app-data
    
    # Security settings
    security_opt:
      - seccomp:unconfined  # Required for Electron's sandboxing
    
    # Shared memory (helps with Chrome/Electron performance)
    shm_size: '2gb'
    
    # Restart policy
    restart: "no"
    
    # Resource limits (adjust as needed)
    mem_limit: 4g
    cpus: 2.0
    
    # Network
    networks:
      - patreon-dl-network

  # Web-based VNC client (noVNC) - Access GUI via browser
  novnc:
    image: geek1011/easy-novnc:latest
    container_name: patreon-dl-novnc
    hostname: novnc
    
    environment:
      # Point to the VNC server (patreon-dl-gui)
      - DISPLAY_NUM=99
      - VNC_HOST=patreon-dl-gui
      - VNC_PORT=5900
      - NOVNC_PORT=8080
      - NOVNC_TITLE=Patreon-DL GUI
    
    ports:
      # Access via browser at http://localhost:8080
      - "8080:8080"
    
    depends_on:
      - patreon-dl-gui
    
    restart: unless-stopped
    
    networks:
      - patreon-dl-network

networks:
  patreon-dl-network:
    driver: bridge
    name: patreon-dl-network